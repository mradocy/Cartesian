FullGame.levelNames = [
    {name:"01 - Beginning",
     startMap:"firstLevel", lastMap:"none", color:FullGame.Til.RED, power:false},
    {name:"02 - The Orb",
     startMap:"firstOrb", lastMap:"firstLevel", color:FullGame.Til.RED, power:false},
    {name:"03 - Bend",
     startMap:"redEyebot", lastMap:"firstOrb", color:FullGame.Til.RED, power:false},
    {name:"04 - Left Wall",
     startMap:"firstReflect", lastMap:"redEyebot", color:FullGame.Til.RED, power:false},
    {name:"05 - Caution",
     startMap:"firstMultReflect", lastMap:"firstReflect", color:FullGame.Til.RED, power:false},
    {name:"06 - Spring",
     startMap:"firstSpring", lastMap:"firstMultReflect", color:FullGame.Til.RED, power:false},
    {name:"07 - Glass",
     startMap:"firstGlass", lastMap:"firstSpring", color:FullGame.Til.RED, power:false},
    {name:"08 - Two Orbs",
     startMap:"firstMultOrb", lastMap:"firstGlass", color:FullGame.Til.RED, power:false},
    {name:"09 - Crumbling",
     startMap:"firstSand", lastMap:"firstMultOrb", color:FullGame.Til.RED, power:false},
    {name:"10 - Red Walled",
     startMap:"platforming1", lastMap:"firstSand", color:FullGame.Til.RED, power:false},
    {name:"11 - Laser on a Line",
     startMap:"firstMovingLasers", lastMap:"platforming1", color:FullGame.Til.RED, power:false},
    {name:"12 - Descent",
     startMap:"trapped", lastMap:"firstMovingLasers", color:FullGame.Til.RED, power:false},
    {name:"13 - Back Room",
     startMap:"trapped2", lastMap:"trapped", color:FullGame.Til.RED, power:false},
    {name:"14 - Perception",
     startMap:"trapped3", lastMap:"trapped2", color:FullGame.Til.RED, power:false},
    {name:"15 - Red Door",
     startMap:"reflectOffDoor", lastMap:"trapped3", color:FullGame.Til.RED, power:false},
    {name:"16 - Hazardous Oculroids",
     startMap:"blueEyebot", lastMap:"reflectOffDoor", color:FullGame.Til.RED, power:false},
    {name:"17 - Another Angle",
     startMap:"blueEyebot2", lastMap:"blueEyebot", color:FullGame.Til.RED, power:false},
    {name:"18 - Safe Corner",
     startMap:"revisit", lastMap:"blueEyebot2", color:FullGame.Til.RED, power:false},
    {name:"19 - Split Path",
     startMap:"split", lastMap:"revist", color:FullGame.Til.RED, power:false},
    {name:"20 - Roplates",
     startMap:"firstRoplate", lastMap:"split", color:FullGame.Til.RED, power:false},
    {name:"21 - Two Roplates",
     startMap:"roplate2", lastMap:"firstRoplate", color:FullGame.Til.RED, power:false},
    {name:"22 - Blue Oculroid",
     startMap:"useEyebot", lastMap:"roplate2", color:FullGame.Til.RED, power:false},
    {name:"23 - Counterattack",
     startMap:"destroyEyebot", lastMap:"useEyebot", color:FullGame.Til.RED, power:false},
    {name:"24 - First Rescue",
     startMap:"firstGem", lastMap:"split", color:FullGame.Til.BLUE, power:false},
    {name:"25 - Deep Blue",
     startMap:"hiddenOrb", lastMap:"firstGem", color:FullGame.Til.BLUE, power:false},
    {name:"26 - Clash of Colors",
     startMap:"redRoplate", lastMap:"hiddenOrb", color:FullGame.Til.BLUE, power:false},
    {name:"27 - Oculroid Force",
     startMap:"multEyebots", lastMap:"redRoplate", color:FullGame.Til.BLUE, power:false},
    {name:"28 - Sand Trek",
     startMap:"sandTrek", lastMap:"multEyebots", color:FullGame.Til.BLUE, power:false},
    {name:"29 - Surfaced",
     startMap:"useShooter", lastMap:"sandTrek", color:FullGame.Til.BLUE, power:false},
    {name:"30 - Star",
     startMap:"star", lastMap:"useShooter", color:FullGame.Til.BLUE, power:false},
    {name:"31 - vs. Anex",
     startMap:"arena", lastMap:"star", color:FullGame.Til.BLUE, power:false},
    {name:"32 - Landing Zone",
     startMap:"openArea", lastMap:"arena", color:FullGame.Til.BLUE, power:false},
    {name:"33 - Slider",
     startMap:"firstSlider", lastMap:"openArea", color:FullGame.Til.RED, power:false},
    {name:"34 - Elevation",
     startMap:"slider2", lastMap:"firstSlider", color:FullGame.Til.RED, power:false},
    {name:"35 - Time's Up",
     startMap:"sandTime", lastMap:"slider2", color:FullGame.Til.RED, power:false},
    {name:"36 - Portals",
     startMap:"firstPortal", lastMap:"sandTime", color:FullGame.Til.RED, power:false},
    {name:"37 - Slider Central",
     startMap:"platforming2", lastMap:"firstPortal", color:FullGame.Til.RED, power:false},
    {name:"38 - Self Destruction",
     startMap:"portalEyebots", lastMap:"platforming2", color:FullGame.Til.RED, power:false},
    {name:"39 - Blue Start",
     startMap:"redStart", lastMap:"portalEyebots", color:FullGame.Til.GREEN, power:false},
    {name:"40 - Second Rescue",
     startMap:"tightReflect", lastMap:"redStart", color:FullGame.Til.GREEN, power:false},
    {name:"41 - vs. Midel",
     startMap:"arena2", lastMap:"tightReflect", color:FullGame.Til.RED, power:false},
    {name:"42 - Deep Descent",
     startMap:"deepDescent", lastMap:"arena2", color:FullGame.Til.RED, power:false},
    {name:"43 - Musgravite Depths",
     startMap:"keyRoom", lastMap:"deepDescent", color:FullGame.Til.RED, power:false},
    {name:"44 - Insignia",
     startMap:"twoGems", lastMap:"keyRoom", color:FullGame.Til.RED, power:false},
    {name:"45 - Blood Roplate",
     startMap:"roplateSpecial", lastMap:"twoGems", color:FullGame.Til.RED, power:false},
    {name:"46 - Portals and Musgravite",
     startMap:"gemPortals", lastMap:"roplateSpecial", color:FullGame.Til.RED, power:false},
    {name:"47 - Temporary Value",
     startMap:"useEyebot2", lastMap:"gemPortals", color:FullGame.Til.RED, power:false},
    {name:"48 - Dimension Blanc",
     startMap:"whiteArea", lastMap:"useEyebot2", color:FullGame.Til.RED, power:false},
    {name:"49 - Send to Limbo",
     startMap:"whiteArea2", lastMap:"whiteArea", color:FullGame.Til.RED, power:false},
    {name:"50 - Glass Houses",
     startMap:"whiteArea3", lastMap:"whiteArea2", color:FullGame.Til.RED, power:false},
    {name:"51 - Reality Transfer",
     startMap:"whiteAreaBuffer", lastMap:"whiteArea3", color:FullGame.Til.RED, power:false},
    {name:"52 - Reality Buffer",
     startMap:"beforeBoss", lastMap:"whiteArea2", color:FullGame.Til.RED, power:false},
    {name:"53 - vs. Gridod",
     startMap:"griddy1", lastMap:"beforeBoss", color:FullGame.Til.RED, power:false},
    {name:"54 - vs. Gridod Part 2",
     startMap:"griddy2", lastMap:"griddy1", color:FullGame.Til.RED, power:false},
    {name:"55 - vs. Gridod Part 3",
     startMap:"griddy3", lastMap:"griddy2", color:FullGame.Til.RED, power:false},
    {name:"56 - Final Rescue",
     startMap:"lastRescue", lastMap:"griddy3", color:FullGame.Til.RED, power:false},
    {name:"57 - Powerchip",
     startMap:"blasting", lastMap:"lastRescue", color:FullGame.Til.RED, power:true},
    {name:"43P - Musgravite Revisted",
     startMap:"keyRoom", lastMap:"blasting", color:FullGame.Til.RED, power:true},
    {name:"42P - Going Up",
     startMap:"deepDescent", lastMap:"keyRoom", color:FullGame.Til.RED, power:true},
    {name:"58 - Overkill",
     startMap:"thickOrbs", lastMap:"deepDescent", color:FullGame.Til.RED, power:true},
    {name:"36P - Ignore Them",
     startMap:"firstPortal", lastMap:"thickOrbs", color:FullGame.Til.RED, power:true},
    {name:"35P - Leftward",
     startMap:"sandTime", lastMap:"firstPortal", color:FullGame.Til.RED, power:true},
    {name:"34P - Piercing Shortcut",
     startMap:"slider2", lastMap:"sandTime", color:FullGame.Til.RED, power:true},
    {name:"59 - Power Precision",
     startMap:"backToOpen", lastMap:"slider2", color:FullGame.Til.RED, power:true},
    {name:"32P - Almost Home",
     startMap:"openArea", lastMap:"backToOpen", color:FullGame.Til.RED, power:true},
    {name:"60 - Grounded",
     startMap:"landedAgain", lastMap:"openArea", color:FullGame.Til.RED, power:false},
    {name:"61 - Green Heart",
     startMap:"artifactRoom", lastMap:"landedAgain", color:FullGame.Til.RED, power:false},
    {name:"62 - Evri Encounter",
     startMap:"evriEncounter", lastMap:"landedAgain", color:FullGame.Til.GREEN, power:false},
    {name:"63 - Doorstep",
     startMap:"pinkLevel", lastMap:"evriEncounter", color:FullGame.Til.GREEN, power:false},
    {name:"64 - Distortion Realm",
     startMap:"worldWrap1", lastMap:"pinkLevel", color:FullGame.Til.GREEN, power:false},
    {name:"65 - Green Path",
     startMap:"worldWrap2", lastMap:"worldWrap1", color:FullGame.Til.GREEN, power:false},
    {name:"66 - Blue Path",
     startMap:"reflectOffSpring", lastMap:"worldWrap2", color:FullGame.Til.GREEN, power:false},
    {name:"67 - Safety",
     startMap:"eyebots", lastMap:"reflectOffSpring", color:FullGame.Til.BLUE, power:false},
    {name:"68 - Roplates Return",
     startMap:"roplates3", lastMap:"eyebots", color:FullGame.Til.GREEN, power:false},
    {name:"69 - Anex Rematch",
     startMap:"wrapArena", lastMap:"roplates3", color:FullGame.Til.BLUE, power:false},
    {name:"70 - Breakaway",
     startMap:"slider3", lastMap:"wrapArena", color:FullGame.Til.BLUE, power:false},
    {name:"71 - Sensitive",
     startMap:"thickRoplate", lastMap:"slider3", color:FullGame.Til.RED, power:false},
    {name:"72 - Final Descent",
     startMap:"beforeFinal", lastMap:"thickRoplate", color:FullGame.Til.RED, power:false},
    {name:"73 - vs. Evri",
     startMap:"finalArena", lastMap:"beforeFinal", color:FullGame.Til.RED, power:false},
    
    
    {name:"S1 - ???",
     startMap:"secret1", lastMap:"platforming1", color:FullGame.Til.RED, power:false},
    {name:"S2 - ???",
     startMap:"secret2", lastMap:"sandTrek", color:FullGame.Til.RED, power:false},
    
    
    
];

FullGame.makeLevelSelect = function(title, backFunction) {
    
    var ret = {};
    ret.title = title;
    ret.backFunction = backFunction;
    ret.secondPart = false;
    ret.codeStr = "";
    ret.konamiCode = false;
    
    ret.levels = [];
    
    ret.bg = null;
    ret.headerText = null;
    ret.backText = null;
    ret.moreText = null;
    
    ret.clear = function() {
        if (this.bg != null){
            this.bg.destroy();
            this.bg = null;
        }
        if (this.headerText != null){
            this.headerText.destroy();
        }
        while(this.levels.length > 0){
            var lvl = this.levels.pop();
            lvl.text.destroy();
            if (lvl.textDesc != undefined){
                lvl.textDesc.destroy();
            }
        }
        if (this.backText != null){
            this.backText.destroy();
        }
        if (this.moreText != null){
            this.moreText.destroy();
        }
    };
    
    ret.create = function(secondPart) {
        this.clear();
        this.secondPart = secondPart;
        this.codeStr = "";
        
        this.bg = game.add.graphics(0, 0);
        this.bg.beginFill(0x000000, .95);
        this.bg.drawRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
        this.bg.endFill();
        
        
        this.HIT_AREA = {x:-5, y:0, width:280, height:29};
        this.NUM_ROWS = 14;
        this.NUM_COLUMNS = 3;
        this.COLUMN_SPACING = 300;

        this.levelDescs = [];
        var start = 0;
        var end = 0;
        var showAll = false;
        var visibleMoreButton = false;
        if (this.secondPart){
            start = this.NUM_ROWS*this.NUM_COLUMNS;
            end = FullGame.levelNames.length;
            visibleMoreButton = true;
        } else {
            start = 0;
            end = Math.min(FullGame.levelNames.length, this.NUM_ROWS*this.NUM_COLUMNS);
        }
        if (FullGame.Vars.demo){
            end = 11;
            showAll = true;
        }
        if (this.konamiCode){
            showAll = true;
            visibleMoreButton = true;
        }
        for (var i=start; i<end; i++){
            var ln = FullGame.levelNames[i];
            if (!showAll){
                var lnStr = ln.startMap;
                if (ln.power)
                    lnStr += "P";
                if (FullGame.Vars.levelsVisited.indexOf(lnStr) == -1)
                    continue;
            }
            this.levelDescs.push({
                txt:ln.name,
                desc:"",
                startMap:ln.startMap,
                lastMap:ln.lastMap,
                color:ln.color,
                power:ln.power
            });
        }
        //if there exists visited levels that aren't being displayed, then the more button should be visible
        for (i=end; i<FullGame.levelNames.length; i++){
            ln = FullGame.levelNames[i];
            var lnStr = ln.startMap;
            if (ln.power)
                lnStr += "P";
            if (FullGame.Vars.levelsVisited.indexOf(lnStr) != -1){
                visibleMoreButton = true;
            }
        }
        
        
        this.headerText = game.add.text(
            50,
            40,
            "Level Select",
            { font: "19px Verdana", fill: FullGame.Menus.UNSELECTED_COLOR });
        
        for (var i=0; i<this.levelDescs.length; i++){
            var desc = this.levelDescs[i];
            var row = i % this.NUM_ROWS;
            var col = Math.floor(i / this.NUM_ROWS);
            var lvl = {};
            lvl.text = game.add.text(
                this.headerText.x + col*this.COLUMN_SPACING,
                89 + row*29,
                desc.txt,
                { font: "20px Verdana", fill: FullGame.Menus.UNSELECTED_COLOR });
            /*lvl.textDesc = game.add.text(
                lvl.text.x + 30,
                lvl.text.y + 25,
                desc.desc,
                { font: "16px Verdana", fill: FullGame.Menus.UNSELECTED_COLOR });*/
            lvl.startMap = desc.startMap;
            lvl.lastMap = desc.lastMap;
            lvl.color = desc.color;
            lvl.power = desc.power;
            
            this.levels.push(lvl);
        }
        
        this.backText = game.add.text(
            this.headerText.x,
            515,
            "BACK",
            { font: "24px Verdana", fill: FullGame.Menus.UNSELECTED_COLOR });
        this.moreText = game.add.text(
            900,
            this.backText.y,
            "MORE",
            { font: "24px Verdana", fill: FullGame.Menus.UNSELECTED_COLOR });
        this.moreText.visible = visibleMoreButton;
    };
    
    ret.textSelected = null;
    ret.prevTextSelected = null;
    ret.levelSelected = null;
    
    ret.update = function() {
        
        var dt = game.time.physicsElapsed;
        
        //konami code to unlock full level select
        if (FullGame.Keys.leftPressed)
            this.codeStr += "l";
        if (FullGame.Keys.upPressed)
            this.codeStr += "u";
        if (FullGame.Keys.downPressed)
            this.codeStr += "d";
        if (FullGame.Keys.rightPressed){
            this.codeStr += "r";
            var str = this.codeStr.substring(Math.max(0,this.codeStr.length-8));
            if (str == "uuddlrlr"){
                this.konamiCode = true;
                this.clear();
                this.create(this.secondPart);
                this.title.reticle.bringToTop();
            }
        }
        
        
        //cursor selecting other text
        var x = FullGame.Keys.mouseX;
        var y = FullGame.Keys.mouseY;
        this.textSelected = null;
        
        for (var i=0; i<this.levels.length+2; i++) {
            var lvl, txt;
            if (i == this.levels.length){
                lvl = null;
                txt = this.backText;
            } else if (i == this.levels.length+1){
                lvl = null;
                txt = this.moreText;
            } else {
                lvl = this.levels[i];
                txt = lvl.text;
            }
            if (!txt.visible) continue;
            if (txt == this.headerText) continue;
            if (txt.x+this.HIT_AREA.x <= x &&
                x <= txt.x+this.HIT_AREA.x+this.HIT_AREA.width &&
                txt.y+this.HIT_AREA.y <= y &&
                y <= txt.y+this.HIT_AREA.y+this.HIT_AREA.height){
                this.textSelected = txt;
                this.levelSelected = lvl;
            }
        }
        
        if (this.textSelected != this.prevTextSelected){
            if (this.prevTextSelected != null){
                this.prevTextSelected.clearColors();
                this.prevTextSelected.addColor(FullGame.Menus.UNSELECTED_COLOR, 0);
            }
            if (this.textSelected != null){
                this.textSelected.clearColors();
                this.textSelected.addColor(FullGame.Menus.SELECTED_COLOR, 0);
            }
            this.prevTextSelected = this.textSelected;
        }
        
        if (FullGame.Keys.lmbPressed && this.textSelected != null &&
            this.textSelected.visible){
            
            if (this.textSelected == this.backText){
                
                this.backFunction(this.title, false);
                this.clear();
                
            } else if (this.textSelected == this.moreText){
                
                var secondPart = this.secondPart;
                this.clear();
                this.create(!secondPart);
                this.title.reticle.bringToTop();
                
            } else {
                
                FullGame.Vars.startMap = this.levelSelected.startMap;
                FullGame.Vars.lastMap = this.levelSelected.lastMap;
                FullGame.Vars.playerLaserColor = this.levelSelected.color;
                FullGame.Vars.playerLaserColorOnLevelStart = this.levelSelected.color;
                var power = false;
                if (this.levelSelected.power != undefined)
                    power = this.levelSelected.power;
                if (power){
                    FullGame.Vars.playerLaserType = FullGame.Til.LASER_THICK;
                } else {
                    FullGame.Vars.playerLaserType = FullGame.Til.LASER_NORMAL;
                }
                FullGame.Vars.playerLaserTypeOnLevelStart = FullGame.Vars.playerLaserType;
                
                this.backFunction(this.title, true);
                this.clear();
                
            }
            
        }
        
        
    };
    
    
    return ret;
    
};